# ElderSpy

## Utilisation
### Pr√©requis
- Docker
- JDK 17
- Maven 3.9.6
- Kubernetes environment (optional)

### Ex√©cution du projet
1. Cloner le repository
2. Construire et d√©marrer les conteneurs backend
```shell
~/backend $ docker-compose up --build -d
```
3. Construire et d√©marrer les conteneurs edge
```shell
~/gateway $ docker-compose up --build -d
```
(optionnel) D√©ploiement Kubernetes (Work In Progress)
```shell
~/backend/kubernetes $ kubectl apply -f ./namespace -f ./config-maps -f ./deployments -f ./services -f ./secrets -f ./hpa -n elderspy-ns
```
Acc√©der aux services suivants :

NodeRed (simulation capteurs):
```
http://localhost:1880/
```

InfluxDB UI:
```
http://localhost:8086/

username: admin
password: admin123
```
Grafana UI:
```
http://localhost:4000/

username: admin
password: admin123
```

## Architecture

### Aper√ßu
![architecture overview](/docs/resource/full_archi.png)

### Communication Edge-Backend
![architecture overview](/docs/resource/edge_backend_comm.png)

### Backend
![architecture overview](/docs/resource/only_backend.png)

### Edge et Assistant
![architecture overview](/docs/resource/assistant_and_edge.png)

### Edge (Data processing)
![architecture overview](/docs/resource/data_processing_edge.png)

## Documentation

### Alerting via SMS
Actuellement, le service d'alerte est configur√© pour envoyer des alertes SMS √† un num√©ro de t√©l√©phone pr√©d√©fini via une API SMS.
Le service est d√©clench√© lorsque le service d'analyse de t√©l√©m√©trie d√©tecte une anomalie dans les donn√©es ou lorsqu'une alerte est re√ßue du edge.
Le service d'alerte utilise l'`API Free SMS` pour envoyer les alertes SMS.

Si vous souhaitez utiliser le service d'alerte SMS, vous devez fournir les variables d'environnement suivantes, par exemple via un fichier`.env` situ√© dans le r√©pertoire `~/backend/services/gsm-gateway`:
- `FREE_SMS_API_USER`: Nom d'utilisateur pour l'API Free SMS
- `FREE_SMS_API_PASS`: Mot de passe pour l'API Free SMS

---

### Telemetry client service API for Edge simulation

Cette API simule les donn√©es des capteurs publi√©es par les dispositifs edge. Lorsqu'elle est utilis√©e, elle publie des messages sur le m√™me sujet que celui du edge, simulant ainsi des donn√©es de t√©l√©m√©trie r√©elles. La simulation permet de tester et de surveiller le flux de donn√©es via RabbitMQ jusqu'au backend.  

| **Endpoint**                         | **Method** | **Description**                                                                                                   | **Request Body**                                                                                                            |
|--------------------------------------|------------|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| `/api/telemetry/send`                | `POST`     | Simulates a single sensor data entry with a timestamp, `edgeId`, `deviceId`, `measurement`, and `value`.         | ``` { "timestamp": "{{$isoTimestamp}}", "edgeId": "edge-001", "deviceId": "device-001", "measurement": "temperature", "value": 30.5 } ``` |
| `/{edgeId}/{deviceId}/start`         | `POST`     | Starts a continuous simulation of sensor data for the specified `edgeId` and `deviceId`.                         | None                                                                                                                        |
| `/{edgeId}/{deviceId}/stop`          | `POST`     | Stops the continuous simulation of sensor data for the specified `edgeId` and `deviceId`.                        | None                                                                                                                        |

**Notes**:
- **Simulation Trigger**: D√©clenchement de la simulation : Ces endpoints simulent le comportement d'un dispositif edge en envoyant des messages sur le sujet attendu.
- **Message Flow**: Les donn√©es envoy√©es via ces endpoints seront transmises via le broker RabbitMQ, ce qui les rend accessibles au service backend pour un traitement ult√©rieur.

---

## Risk analysis

Voici un exemple de matrice de risque au format README. Cette matrice peut √™tre utile pour identifier, √©valuer et prioriser les risques en fonction de leur probabilit√© et de leur impact.

---

# Matrice de Risque

Voici la matrice de risques sur les principaux probl√®mes que nous avons identifi√©s. Pour rappel, les risques ssont class√©s en fonction de leur **probabilit√©** et de leur **impact**. 

---

|                  | **Impact Faible** | **Impact Mod√©r√©** | **Impact Important** | **Impact Grave**       | **Impact Catastrophique**       |
|------------------|-------------------|--------------------|-----------------------|-------------------------|----------------------------------|
| **Probabilit√© Tr√®s Faible** |               |                     |                        |                         |                                  |
| **Probabilit√© Faible**      |               |                     |üü° **R7** (Intrusion AMQP/MQTT) | üü† **R9** (Saturation stockage SQLite) |                                  |
| **Probabilit√© Moyenne**     |               |üü† **R6** (Mauvaise configuration des agents) | üü† **R3** (Fiabilit√© capteurs IoT) | üî¥**R5** (Panne Stream Processing) -  üî¥**R4** (Performances Raspberry Pi)  | üî¥**R8** (Panne RabbitMQ)           |
| **Probabilit√© √âlev√©e**      |               |  |  | üî¥**R2** (Indisponibilit√© des Services) | üî¥**R1** (S√©curit√© des donn√©es)      |

---

## L√©gende des couleurs

- üîµ **Faible** : Risque mineur, n√©cessite peu ou pas de mesures d'att√©nuation.
- üü° **Mod√©r√©** : Risque mod√©r√©, surveill√© et g√©r√© si n√©cessaire.
- üü† **Significatif** : Risque important, actions d'att√©nuation √† consid√©rer.
- üî¥ **Critique** : Risque majeur, n√©cessite des mesures imm√©diates et des plans de gestion.


---
1. **Risque de s√©curit√© des donn√©es (R1)**
   - Ce risque est critique en raison de la nature sensible des donn√©es m√©dicales √©chang√©es. Une fuite de ces informations pourrait avoir des r√©percussions √©normes. √âtant donn√© le nombre d'interm√©diaire parmis lequel circule ces donn√©es ainsi que la nature de ces donn√©es. Ce risque est class√© comme "Important" et "Catastrophique" il est donc primordial de s√©curiser ces donn√©es.

2. **Risque d‚Äôindisponibilit√© de certains services (R2)**
   - La perte de connectivit√© √† certains services est aussi un risque √† prendre en compte, notre syst√®me utilisant √©norm√©ment de micro-services, il est important de bien g√©rer pour chaucun les cas il n'y aura plus de contact avec l'exterieur. La probabilit√© de ce risque est √©lev√©e, et l'impact est grave car il interromprait le fonctionnement normal du syst√®me. Quand bien m√™me des syst√®mes de fonctionnement offline soient mis en placess, leurs fonctionnement resterait limit√©.

3. **Risque de fiabilit√© des capteurs IoT (R3)**
   - Les capteurs qui sont pr√©sents dans les domiciles que elderspy mets √† disposition, bien que tr√®s performants peuvent tomber en panne ou se d√©connecter. L'impact peut varier (en fonction du type de capteur) nous placerons ici le risque le plus √©lev√© parmis tous ces capteurs : Important. En effet, certains capteurs peuvent tomber en panne sans grande incidence pour le patient (Temperature de l'environnement / Qualit√© de l'air int√©rieur). Cependant, certains capteurs surveillant les constantes vitales du patient se doivent d'avoir une disponibilit√© constante. La moindre d√©connexion peut mener √† une perte importante de donn√©es (manque de donn√©es pour reconnaitre des patterns sur les mod√®les de maladies cardiaques par exemple)

4. **Risque de performances du Raspberry Pi (R4)**
   - Le Raspberry Pi est la passerelle principale, en fonction du nombre d'appareils √† traiter, des probl√®mes de performance et, entre autre de surchauffe peuvent survenirs. Cela conduirait √† une indisponibilit√© temporaire de la gateway, ce qui serait grave.

5. **Risque de panne du service de date processing (R5)**
   - Le service de traitement de flux est critique pour l‚Äôanalyse en temps r√©el. Sa panne ralentirait le traitement et pourrait emp√™cher la d√©tection d‚Äô√©v√©nements. La probabilit√© est moyenne, car bien que le Raspberry Pi soit limit√© en ressources, des red√©marrages automatiques et des protections peuvent limiter les interruptions.

6. **Risque de Mauvaise configuration des diff√©rents agents (R6)**
   - La mauvaise configuration des agents peut causer des probl√®mes temporaires, mais les effets sont en g√©n√©ral r√©cup√©rables avec des ajustements ou un red√©marrage. La probabilit√© est moyenne en raison de la complexit√© des configurations requises pour l'int√©gration de divers services.

7. **Risque d‚Äôintrusion via les services AMQP et MQTT (R7)**
   - Bien que ce risque ait un impact important, la probabilit√© d'une intrusion est r√©duite si les bonnes pratiques de s√©curit√© (chiffrement et authentification) sont appliqu√©es.

8. **Risque de panne du RabbitMQ ou des services de messagerie (R8)**
   - RabbitMQ est central dans cette architecture pour la gestion des messages, et sa non-disponibilit√©e causerait des perturbations majeures. La probabilit√© est moyenne, car bien que RabbitMQ soit fiable, il peut √™tre soumis √† des interruptions si la charge est √©lev√©e ou si une maintenance non planifi√©e se produit.

9. **Risque de manque de capacit√© de stockage (SQLite sur le Pi) (R9)**
    - La saturation du stockage SQLite est possible si les donn√©es ne sont pas r√©guli√®rement archiv√©es ou supprim√©es, ou encore, si un acc√®s √† Internet coup√© de mani√®re trop prolong√©. Bien que l'impact soit grave (perte de donn√©es), la probabilit√© est faible si un syst√®me de gestion de donn√©es efficace est mis en place. M√™me en cas de coupure d'acc√®s internet, le syst√®me doit √™tre en parfaite capacit√© de fonctionner de mani√®re autonome.


---

## Code structure

```plaintext
elderspy/
‚îú‚îÄ‚îÄ backend/                               # Services backend et configurations
‚îÇ   ‚îú‚îÄ‚îÄ grafana-provisioning/               # Configuration de provisionnement des tableaux de bord Grafana et sources de donn√©es (InfluxDB)
‚îÇ   ‚îú‚îÄ‚îÄ kubernetes/                         # Configurations de d√©ploiement Kubernetes et ressources manifests
‚îÇ   ‚îú‚îÄ‚îÄ rabbitmq/                           # Configurations de RabbitMQ (plugins)
‚îÇ   ‚îú‚îÄ‚îÄ services/                           # Microservices du backend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/                          # Modules partag√©s et utilitaires
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alerting-service/                # Service pour les notifications d'alerte
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gsm-gateway/                     # Service de passerelle GSM pour la communication GSM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telemetry-analyser-service/      # Analyse les donn√©es de t√©l√©m√©trie
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telemetry-client/                # Client pour l'envoi des donn√©es de t√©l√©m√©trie
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telemetry-ingestion-service/     # Service pour g√©rer l'ingestion des donn√©es de t√©l√©m√©trie
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml                  # Fichier Docker Compose pour ex√©cuter les services backend, InfluxDB, RabbitMQ et Grafana
‚îú‚îÄ‚îÄ gateway/                                # Composants li√©s √† la passerelle (Edge)
‚îÇ   ‚îú‚îÄ‚îÄ include/                             # Fichiers d'en-t√™te et autres inclusions
‚îÇ   ‚îú‚îÄ‚îÄ src/                                 # Code source pour la passerelle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ alert/                            # Logique de gestion des alertes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt-clients/                     # Clients MQTT pour la communication de messages
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/                           # Fichiers de configuration pour les capteurs
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml                   # Fichier Docker Compose pour les services de la passerelle
‚îú‚îÄ‚îÄ sensors/                                # Configurations des capteurs
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile                           # Configuration Docker pour le module de capteur
‚îÇ   ‚îî‚îÄ‚îÄ flows.json                           # Flux Node-RED pour le module de capteur
‚îî‚îÄ‚îÄ README.md                               # Fichier principal de documentation du projet
```

## How to contribute

We welcome contributions to the **elderspy** project! Here‚Äôs how you can get involved:

### 1. Fork the Repository
- Start by forking the repository to your own GitHub account.

### 2. Clone the Repository
- Clone your forked repository to your local machine:
```bash
git clone https://github.com/your-username/elderspy.git
```

### 3. Set Up the Environment
- Ensure you have the necessary dependencies installed, including Docker and any specific tools listed in the README.md.

### 4. Make Changes
- Make your changes to the codebase. Ensure that your changes are in line with the project‚Äôs guidelines and coding standards.
- Test your changes locally to ensure they function as expected.
- Add tests for your changes if applicable.
- Update the documentation to reflect your changes if necessary.
- Commit your changes and push them to your forked repository.

### 5. Create a Pull Request
- Create a pull request to the main repository.
- Ensure your pull request description clearly explains the changes you‚Äôve made and the reason for the changes.

### 6. Review and Collaborate
- Participate in the code review process by responding to feedback and making any necessary changes to your pull request.
